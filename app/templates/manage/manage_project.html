{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}

{% block title %}项目管理{% endblock %}
{% block head %}
{{ super() }}
<script type="text/javascript">
    $(document).ready(function() {
        //删除按钮触发函数
        $(".btn-danger").click(function () {
            var xmlhttp;
            var pid = $(this).attr('id');
            if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            }
            else {// code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    $('#'+pid).parent().parent().remove();
                }
            }
            xmlhttp.open("DELETE", "/manage/delete/" + pid, true);
            xmlhttp.send();
        });
        //退出按钮触发函数
         $(".btn-warning").click(function () {
            var xmlhttp;
            var pid = $(this).attr('id');
            if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp = new XMLHttpRequest();
            }
            else {// code for IE6, IE5
                xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange = function () {
                if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    $('#'+pid).parent().parent().remove();
                }
            }
            xmlhttp.open("PUT", "/manage/quit/" + pid, true);
            xmlhttp.send();
        });
    });



</script>

{% endblock %}
{% block page_content %}
<div class="container">
<div class="row" style="margin-top:20px;margin-bottom:20px;">
     <div>
            <table class="table table-hover">
                <thead>
                <tr>
                    <th width="15%">项目名</th>
                    <th width="35%">项目内容</th>
                    <th width="10%">创建时间</th>
                    <th width="15%">创建人</th>
                    <th width="10%">状态</th>
                    <th width="15%"> <th>
                </tr>
                </thead>
                <tbody>
                {% for p in projects %}
                        <tr>
                            <td>{{ p.name }}</td>
                            <td>{{ p.content }}</td>
                            <td>{{ moment(p.create_at).fromNow(refresh=True) }}</td>
                            <td>
                                {{ p.creator.name }}
                            </td>
                            <td>{% if p.status %} 已完成 {% else %} 未完成 {% endif %}</td>
                            <td>
                                {% if current_user == p.creator %}
                                    <a  id="{{ p.id }}"
                                       role="button" class="btn btn-danger"> 删除 </a>
                                {% else %}
                                <a id="{{ p.id }}" href="" role="button" class="btn btn-warning"> 退出 </a>
                                {% endif %}
                            </td>
                        </tr>
                {% endfor %}
                </tbody>
            </table>

    </div>
</div>
<div class="row">
 <div class="col-md-4 col-md-offset-4">
 <div class="pagination">
        {{ macros.pagination_widget(pagination, '.index') }}
 </div>
</div>
</div>

{% endblock %}
