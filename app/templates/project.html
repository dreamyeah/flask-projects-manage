{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}

{% block title %}项目进度管理系统{% endblock %}
{% block body_attribs %}
{% endblock %}
{% block head %}
{{ super() }}
<script src="http://libs.baidu.com/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript">
      var xmlhttp;
      var finish_steps_length = {{ finish_steps_length }};
      var steps_length = {{ steps_length }};
      if (window.XMLHttpRequest) { // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp = new XMLHttpRequest();
      } else { // code for IE6, IE5
        xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
      }

      xmlhttp.onreadystatechange = function() {
        if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            $("#"+xmlhttp.responseText).attr("class","btn btn-success");
            $("#"+xmlhttp.responseText).attr("disabled","disabled");
            $("#"+xmlhttp.responseText).text("已解决");
            finish_steps_length ++;
            var progress = (finish_steps_length / steps_length) * 100;
            $("#progress-bar").attr("aria-valuenow", progress);
            $("#progress-bar").attr("style", "width:"+ progress +"%");
            if(finish_steps_length == steps_length){
               $("#project_status").text("完成");
            };

        }}
      $(document).ready(function(){
          $(".btn-danger").click(function(){
               if (confirm("确定已完成当前步骤？")==true)
               {

                  var sid = $(this).attr("id");
                  xmlhttp.open("GET", "/step/finish/"+sid, true);
                  xmlhttp.send();
               }
          });
        });

</script>

{% endblock %}

{% block page_content %}
    <!-- start header -->

<div class="container" >
<div class="row" style="margin-top:20px;margin-bottom:20px;">
<div class="col-md-3">
    <a class="btn btn-primary" role="button" href="{{ url_for('main.create_project') }}" style="margin-top:0px;margin-bottom:10px;">+ 新建一个项目</a>
    {% if projects == [] %}

        <h4> 没有项目 </h4>
    {% else %}
        <h3> 我参与的项目 </h3>
        <div class="list-group">

            {% for p in projects %}
                 {% if p == project %}
                 <a href="{{ url_for('.project', id=p.id) }}" class="list-group-item active">{{ p.name }}</a>
                 {% else %}
                    {% if p.status %}
                    <a href="{{ url_for('.project', id=p.id) }}" class="list-group-item list-group-item-success">{{ p.name }}</a>
                    {% else %}
                    <a href="{{ url_for('.project', id=p.id) }}" class="list-group-item ">{{ p.name }}</a>
                    {% endif %}
                 {% endif %}
            {%  endfor %}
        </div>
    {% endif %}
</div>
<div class="col-md-9">
    <div class="panel panel-default">
      <!-- Default panel contents -->
      <div class="panel-heading">  <h2>{{ project.name }}</h2> <h4 id="project_status" class="text-right">{% if project.status%} 完成 {% else %} 未完成 {% endif %}</h4></div>
      <div class="panel-body">
        <h3> {{ project.content }}</h3>
      </div>
<div class="progress"  style="margin-top:0px;margin-bottom:20px;">
  <div id="progress-bar" class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="{{ progress }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ progress }}%">
    <span class="sr-only"></span>
  </div>
    </div>
      <!-- Table -->
      <table class="table table-hover">
        <thead>
          <tr>
            <th>#</th>
            <th>content</th>
            <th>position</th>
          </tr>
        </thead>
    {% for s in project.steps %}
        <tbody>
          <tr>
            <th scope="row"></th>
            <td> <h4> {{ s.content }} </h4></td>
            <td>
                {% if  s.status  %}
                    <a class="btn btn-success" role="button"  disabled="disabled"> 已解决 </a>
                {% else %}
                    <a class="btn btn-danger" role="button"  id="{{ s.id }}"> 待解决 </a>
                {% endif %}
            </td>
          </tr>
        </tbody>
     {% endfor %}
      </table>
    </div>


</div>
</div>
</div>
{% endblock %}
